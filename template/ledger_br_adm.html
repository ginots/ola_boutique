<!DOCTYPE html>
{% load static %}
<html lang="en">


{% include "navbar.html" %}

<style>
  main { margin-left: 0 !important; }
  .table-responsive { max-height: 70vh; }
  .search-box { min-width: 300px; }
  .action-buttons { gap: 8px; }
</style>

<div class="container-fluid">

<!--  <h3 class="fw-bold text-primary mb-3">{{ branch.branch_name }}</h3>-->

  <!-- Filters -->
  <form method="get" class="row g-2 mb-4">

    <div class="col-md-3">
      <label>Account</label>
      <select name="account" class="form-select" required>
        <option value="">Select Account</option>
        {% for a in accounts %}
        <option value="{{ a.id }}" {% if selected_account and a.id == selected_account.id %}selected{% endif %}>
          {{ a.acount_type.account_type }} - {{ a.name }}
        </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2">
      <label>From</label>
      <input type="date" name="from_date" value="{{ from_date }}" class="form-control">
    </div>

    <div class="col-md-2">
      <label>To</label>
      <input type="date" name="to_date" value="{{ to_date }}" class="form-control">
    </div>

    <div class="col-md-2">
      <label>Search</label>
      <input type="text" name="q" value="{{ query }}" class="form-control" placeholder="Description...">
    </div>

    <div class="col-md-2">
      <label>Entries</label>
      <select name="entries" class="form-select">
        <option value="10" {% if entries == 10 %}selected{% endif %}>10</option>
        <option value="20" {% if entries == 20 %}selected{% endif %}>20</option>
        <option value="50" {% if entries == 50 %}selected{% endif %}>50</option>
        <option value="100" {% if entries == 100 %}selected{% endif %}>100</option>
      </select>
    </div>

    <div class="w-100"></div>

    <div class="col-md-1 d-flex align-items-end">
      <button class="btn btn-primary w-100">Go</button>
    </div>
    <div class="col-md-1 d-flex align-items-end">
    <button type="button" onclick="exportData()" class="btn btn-link text-success p-0 me-3">
         <i class="fas fa-download"></i> Export
    </button>
    </div>

  </form>


  {% if selected_account %}
  <!-- Opening Balance -->
  <div class="alert alert-info mb-3">
    <strong>Opening Balance:</strong> {{ opening_balance }}
  </div>

  <div class="table-responsive">
    <table class="table table-bordered align-middle">

      <thead class="table-dark text-dark">
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Debit</th>
          <th>Credit</th>
          <th>Balance</th>
        </tr>
      </thead>

      <tbody>
        {% for entry in page_obj %}
        <tr>
          <td>{{ entry.date }}</td>
          <td>{{ entry.description }}</td>
          <td>{{ entry.debit }}</td>
          <td>{{ entry.credit }}</td>
          <td><strong>{{ entry.balance }}</strong></td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted">No entries found.</td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

  <!-- Pagination -->
  <nav>
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}&account={{ selected_account.id }}">«</a>
      </li>
      {% endif %}

      <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}&account={{ selected_account.id }}">»</a>
      </li>
      {% endif %}
    </ul>
  </nav>

  {% endif %}

</div>


</div>
        <!-- Content End -->



    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{% static 'lib/chart/chart.min.js' %}"></script>
    <script src="{% static 'lib/easing/easing.min.js' %}"></script>
    <script src="{% static 'lib/waypoints/waypoints.min.js' %}"></script>
    <script src="{% static 'lib/owlcarousel/owl.carousel.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/moment-timezone.min.js' %}"></script>
    <script src="{% static 'lib/tempusdominus/js/tempusdominus-bootstrap-4.min.js' %}"></script>

    <!-- Template Javascript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script>
        document.querySelectorAll("form").forEach(function(form) {

            form.addEventListener("keydown", function(e) {

                if (e.key === "Enter" && !e.ctrlKey &&
                    (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA")) {

                    e.preventDefault();

                    let fields = Array.from(
                        form.querySelectorAll("input:not([type=hidden]):not([readonly]), textarea")
                    );

                    let index = fields.indexOf(e.target);

                    if (fields[index + 1]) {
                        fields[index + 1].focus();
                        fields[index + 1].select?.();
                    }
                }

                // CTRL + ENTER → Submit form
                if (e.key === "Enter" && e.ctrlKey) {
                    form.submit();
                }

            });

        });
    </script>
    <script>
        function exportData() {
            const urlParams = new URLSearchParams(window.location.search);
            window.location.href = "{% url 'export_ledger_csv' %}?" + urlParams.toString();
        }
    </script>
</body>
</html>